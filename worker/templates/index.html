<!DOCTYPE HTML>
<html>
<head>
	<title>Flask-SocketIO-Celery</title>
	<script type="text/javascript" src="//code.jquery.com/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
    <script type="text/javascript" charset="utf-8">
    
    $(document).ready(function(){
        namespace = '/';
        
            const socket = io.connect('http://' + document.domain + ':' + location.port + namespace , {forceNew:false});
            // upon the connetion, the client emits an event to the server called 'connection'  
            socket.on('connect', function(){

            });
        
            socket.on('room_created', function(response){
                const roomId = response.room_id
                $('#receive_div').append(`<div id="${response.room_id}">${response.room_id}:     <span id="room_${response.room_id}_content"></span>`);
            });
            // 'response' event invokes the client callback function to greet the client with a message 
            // after running background tasks through celery   
            socket.on('response', function(response){
                var response_str = response.percentage + '% '+response.message + "&&&" + response.taskId;   
                $(`#room_${response.taskId}_content`).text(response_str);
            });

            $('#start_task').click(function(){
                console.log('create_task');
                socket.emit('create_task', {
                    sessionToken: 'no-token',
                    taskName: 'create_promoter_terminator',
                    params: {
                        projectId: '',
                        promoterLength: 500,
                        terminatorLength: 200,
                    }
                });
            })



        // 'submit_form' event is emitted to the server upon the form submission
        $('form#emit').submit(function(event) {
            socket.emit('submit_name', {name: $('#emit_name').val()});
            return false;

        });     

    });
    </script>

</head>
<body>
	<h1>Flask-SocketIO-Celery simple example</h1>
	<br>
	<h3>Enter your name:</h3>
	<form id="emit" method="POST" action="#">
		<input type="text" id="emit_name" name="emit_name" placeholder="your name">
		<input type="submit" value="send">
	</form>
    <br>
    <button id="start_task">task1</button>
    
	<h2>Receive:</h2>
	<div id="receive_div"></div>
</body>
</html>



